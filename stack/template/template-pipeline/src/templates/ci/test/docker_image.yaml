variables:
  DOCKER_TEST_COMMAND: 'ls -l | grep $VERSION'
  
.docker_test:
  image: itau-docker-base.depdes.artifactory.prod.cloud.ihf/docker:cli
  variables:
    DOCKER_HOST: tcp://docker:2375
    DOCKER_DRIVER: overlay2
    DOCKER_REGISTRY: itau-docker-base.depdes.artifactory.prod.cloud.ihf
  services:
    - alias: docker
      name: itau-docker-base.depdes.artifactory.prod.cloud.ihf/docker:dind
      command: ["--insecure-registry=itau-docker-base.depdes.artifactory.prod.cloud.ihf"]
  stage: test
  only:
    - branches
    - tags
  script:
    - docker load -i $CI_PROJECT_NAME-$VERSION.tar
    - docker run -i --rm $CI_PROJECT_NAME:$VERSION $DOCKER_TEST_COMMAND
    - exit $?
  tags:
    - ci


# Example Usage:

  # test_5.4.0:
  #   extends: .docker_test
  #   variables:
  #     VERSION: 5.4.0
